pipeline{
    agent any


    stages{
        stage ('Restore Packages'){
            steps {
                //define the single or multiple step
                bat 'echo Restore Package'
            }
        }
        stage('Build') {
            steps {
                // Build your Maven project
                bat 'mvn clean test'
            }
        }

        stage('Karate Tests') {
            steps {
                // Run Karate tests
                bat 'mvn test-compile exec:java -Dexec.mainClass="com.intuit.karate.Main" -Dexec.args="--features=classpath:features --tags=@testUsers"'
            }
        }
                stage('Generate Report') {
                    steps {
                        // Generate Karate HTML report
                        bat 'mvn verify'
                    }
                }
            }
     post {
        always {
            junit 'target/karate-reports/*.xml'
            cucumber failedFeaturesNumber: -1, failedScenariosNumber: -1, failedStepsNumber: -1, fileIncludePattern: '**/*.json', jsonReportDirectory: 'target/karate-reports', pendingStepsNumber: -1, reportTitle: 'Karate Test Execution', skipEmptyJSONFiles: true, skippedStepsNumber: -1, sortingMethod: 'ALPHABETICAL', undefinedStepsNumber: -1
        }

    }
}