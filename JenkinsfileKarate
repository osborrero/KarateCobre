pipeline {
    agent any

    stages {
        stage('Build Dependencies') {
            steps {
                sh 'mvn clean install' // Executes Maven commands for building and installing dependencies
            }
        }
        stage('Run Tests') {
            steps {
                sh 'java -jar target/your-project-name-jar-with-dependencies.jar' // Replace with your Karate JAR name
            }
        }
        stage('Generate Report') {
            steps {
                script {
                    // Read the karateOutputPath from the previous stage (optional)
                    def karateOutputPath = sh(script: 'cat karate-output.txt', returnStdout: true).trim()
                    generateReport(karateOutputPath) // Call the generateReport method
                }
            }
        }
    }

    post {
        always {
            archiveArtifacts '**/*.json' // Archive all generated JSON reports
            junit 'target/**/*.xml' // Archive JUnit reports (if generated)
        }
        success {
            // Optional: Send notifications on success
        }
        failure {
            // Optional: Send notifications on failure
        }
    }
}

def generateReport(String karateOutputPath) {
    // Code from your GeneralRunner.java (assuming it's in the same directory as Jenkinsfile)
    sh """
        java -cp . com.your.package.GeneralRunner generateReport '${karateOutputPath}'
    """
}